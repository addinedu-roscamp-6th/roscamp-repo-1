{% extends "base.html" %}
{% block title %}얼굴 등록 현황 · guardian{% endblock %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-header py-3">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
      <div>
        <h5 class="mb-0">직원 등록 현황</h5>
        <small class="text-muted">총 {{ total_count }}건</small>
      </div>
      <form class="d-flex gap-2" method="get" action="{{ url_for('faces_list') }}">
        <input class="form-control" type="search" name="q" value="{{ request.args.get('q','') }}" placeholder="이름 검색">
        <select class="form-select" name="sort">
          <option value="created_desc" {{ 'selected' if request.args.get('sort')=='created_desc' else '' }}>최신순</option>
          <option value="created_asc"  {{ 'selected' if request.args.get('sort')=='created_asc' else '' }}>오래된순</option>
          <option value="name_asc"     {{ 'selected' if request.args.get('sort')=='name_asc' else '' }}>이름 A→Z</option>
          <option value="name_desc"    {{ 'selected' if request.args.get('sort')=='name_desc' else '' }}>이름 Z→A</option>
        </select>
        <button class="btn btn-success" type="submit">검색</button>
      </form>
    </div>
  </div>
  <div class="card-body">
    {% if faces %}
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr>
            <th style="width:60px;">#</th>
            <th>이름</th>
            <th>등록 시간</th>
            <th style="width:120px;">작업</th>
          </tr>
        </thead>
        <tbody>
        {% for f in faces %}
          <tr>
            <td>{{ loop.index + (page-1)*page_size }}</td>
            <td class="fw-semibold">{{ f.name }}</td>
            <td><span class="text-muted">{{ f.created_at }}</span></td>
            <td>
              <form method="post" action="/faces/{{ f.id }}/delete"
                    onsubmit="return confirm('(더미) 목록에서만 제거됩니다. 진행할까요?');">
                <button class="btn btn-sm btn-outline-danger" type="submit">삭제</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <nav class="mt-3" aria-label="페이지">
      <ul class="pagination justify-content-end">
        <li class="page-item {{ 'disabled' if page<=1 else '' }}">
          <a class="page-link" href="?q={{ request.args.get('q','') }}&sort={{ request.args.get('sort','created_desc') }}&page={{ page-1 }}">이전</a>
        </li>
        {% for p in range(1, total_pages+1) %}
        <li class="page-item {{ 'active' if p==page else '' }}">
          <a class="page-link" href="?q={{ request.args.get('q','') }}&sort={{ request.args.get('sort','created_desc') }}&page={{ p }}">{{ p }}</a>
        </li>
        {% endfor %}
        <li class="page-item {{ 'disabled' if page>=total_pages else '' }}">
          <a class="page-link" href="?q={{ request.args.get('q','') }}&sort={{ request.args.get('sort','created_desc') }}&page={{ page+1 }}">다음</a>
        </li>
      </ul>
    </nav>
    {% else %}
      <div class="text-center py-5">
        <p class="mb-2">등록된 데이터가 없습니다.</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
